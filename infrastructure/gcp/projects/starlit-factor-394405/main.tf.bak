locals {
  project_id = "starlit-factor-394405"
}

# View all roles and permissions in the GCP console.
#
# https://console.cloud.google.com/iam-admin/iam?project=starlit-factor-394405

# Understanding roles resources.
#
# https://cloud.google.com/iam/docs/understanding-roles

# Show all roles and permissions via the gcloud cli tool.
#
# gcloud beta asset search-all-iam-policies \
#   --scope='projects/starlit-factor-394405' \
#   --query='policy:sa-example-account-id@starlit-factor-394405.iam.gserviceaccount.com'
resource "google_service_account" "account" {
  account_id   = "sa-example-account-id"
  display_name = "Service Account Example Name"
}

resource "time_rotating" "rotation" {
  rotation_days = 30
}

resource "google_service_account_key" "key" {
  service_account_id = google_service_account.account.name

  keepers = {
    rotation_time = time_rotating.rotation.rotation_rfc3339
  }
}

resource "google_project_iam_member" "binding" {
  project = local.project_id
  role    = "roles/iam.roleViewer"
  member  = google_service_account.account.member
}
